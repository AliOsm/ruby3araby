# تحويل أنواع البيانات

في هذا الدرس، سنتعلم كيفية تحويل البيانات من نوع إلى آخر في روبي. هذه مهارة أساسية، خاصة عند التعامل مع إدخال المستخدم.

## لماذا نحتاج تحويل الأنواع؟

تذكر من الدرس السابق أن `gets` يُرجع دائماً **نصاً** (String)، حتى لو أدخل المستخدم رقماً:

```ruby
puts "أدخل عمرك:"
age = gets.chomp
# String
puts age.class

# محاولة الحساب ستسبب مشكلة!
# خطأ! لا يمكن جمع نص مع رقم
puts age + 5
```

لذلك نحتاج تحويل النص إلى رقم قبل إجراء العمليات الحسابية عليه.

## دوال التحويل الأساسية

### 1. تحويل إلى عدد صحيح: `to_i`

دالة `to_i` (to integer) تحوّل القيمة إلى عدد صحيح:

```ruby
# تحويل نص إلى رقم
"42".to_i      # 42
"100".to_i     # 100
"-25".to_i     # -25

# تحويل رقم عشري إلى صحيح (يحذف الكسر)
3.14.to_i      # 3
9.99.to_i      # 9
-2.7.to_i      # -2

# تحويل قيم منطقية
# خطأ! القيم المنطقية لا تدعم to_i
true.to_i
```

#### سلوك خاص مع النصوص:

```ruby
# يأخذ الأرقام من بداية النص فقط
"123abc".to_i    # 123
"42 سنة".to_i    # 42
"عمري 25".to_i   # 0 (لا يبدأ برقم)

# النصوص غير الرقمية تصبح صفراً
"مرحبا".to_i     # 0
"".to_i          # 0
```

### 2. تحويل إلى عدد عشري: `to_f`

دالة `to_f` (to float) تحوّل القيمة إلى عدد عشري:

```ruby
# تحويل نص إلى عدد عشري
"3.14".to_f      # 3.14
"100".to_f       # 100.0
"-25.5".to_f     # -25.5

# تحويل عدد صحيح إلى عشري
42.to_f          # 42.0
-10.to_f         # -10.0

# سلوك مشابه لـ to_i مع النصوص
"3.14abc".to_f   # 3.14
"السعر 99.9".to_f # 0.0
```

### 3. تحويل إلى نص: `to_s`

دالة `to_s` (to string) تحوّل القيمة إلى نص:

```ruby
# تحويل أرقام إلى نصوص
42.to_s          # "42"
3.14.to_s        # "3.14"
-100.to_s        # "-100"

# تحويل قيم منطقية
true.to_s        # "true"
false.to_s       # "false"

# تحويل nil
nil.to_s         # "" (نص فارغ)

# تحويل رموز
:ruby.to_s       # "ruby"
:مرحبا.to_s      # "مرحبا"

# تحويل مصفوفات
[1, 2, 3].to_s   # "[1, 2, 3]"
```

### 4. تحويل إلى مصفوفة: `to_a`

دالة `to_a` (to array) تحوّل القيمة إلى مصفوفة:

```ruby
# تحويل نطاق إلى مصفوفة
(1..5).to_a          # [1, 2, 3, 4, 5]
(1...5).to_a         # [1, 2, 3, 4]
("a".."e").to_a      # ["a", "b", "c", "d", "e"]

# تحويل قاموس إلى مصفوفة من الأزواج
{a: 1, b: 2}.to_a    # [[:a, 1], [:b, 2]]

# nil تصبح مصفوفة فارغة
nil.to_a             # []
```

## جدول ملخص دوال التحويل

| الدالة | الوصف | مثال | الناتج |
|--------|-------|------|--------|
| `to_i` | تحويل إلى عدد صحيح | `"42".to_i` | `42` |
| `to_f` | تحويل إلى عدد عشري | `"3.14".to_f` | `3.14` |
| `to_s` | تحويل إلى نص | `42.to_s` | `"42"` |
| `to_a` | تحويل إلى مصفوفة | `(1..3).to_a` | `[1, 2, 3]` |

## استخدام التحويل مع إدخال المستخدم

### مثال 1: حساب العمر

```ruby
puts "أدخل سنة ميلادك:"
# تحويل مباشر بعد chomp
birth_year = gets.chomp.to_i

current_year = 2024
age = current_year - birth_year

puts "عمرك تقريباً #{age} سنة"
```

### مثال 2: حساب المساحة

```ruby
puts "أدخل طول المستطيل:"
length = gets.chomp.to_f

puts "أدخل عرض المستطيل:"
width = gets.chomp.to_f

area = length * width
puts "المساحة = #{area}"
```

### مثال 3: جمع رقمين

```ruby
puts "أدخل الرقم الأول:"
num1 = gets.chomp.to_i

puts "أدخل الرقم الثاني:"
num2 = gets.chomp.to_i

sum = num1 + num2
puts "المجموع = #{sum}"
```

## تحويل متسلسل

يمكنك ربط عدة تحويلات معاً:

```ruby
# تنظيف وتحويل في خطوة واحدة
price = "  99.5  ".strip.to_f
# 99.5
puts price

# تحويل من نص إلى رقم ثم إلى نص مرة أخرى
number = "42".to_i.to_s
# String
puts number.class
```

## التحقق من صلاحية التحويل

بما أن `to_i` تُرجع صفراً للنصوص غير الرقمية، يمكنك التحقق من الإدخال:

```ruby
puts "أدخل رقماً:"
input = gets.chomp

if input.to_i.to_s == input
  puts "هذا رقم صحيح!"
  number = input.to_i
else
  puts "الإدخال ليس رقماً صحيحاً"
end
```

### طريقة أفضل باستخدام التعبيرات النمطية:

```ruby
puts "أدخل رقماً:"
input = gets.chomp

if input.match?(/\A-?\d+\z/)
  puts "رقم صحيح: #{input.to_i}"
elsif input.match?(/\A-?\d+\.?\d*\z/)
  puts "رقم عشري: #{input.to_f}"
else
  puts "ليس رقماً"
end
```

## دوال تحويل إضافية

### `Integer()` و `Float()` - تحويل صارم

هذه الدوال ترفع خطأ إذا كان التحويل غير ممكن:

```ruby
# Integer() أكثر صرامة من to_i
Integer("42")      # 42
Integer("42abc")   # ArgumentError! (خطأ)

# Float() أكثر صرامة من to_f
Float("3.14")      # 3.14
Float("abc")       # ArgumentError! (خطأ)
```

### `to_sym` - تحويل إلى رمز

```ruby
"ruby".to_sym      # :ruby
"hello_world".to_sym  # :hello_world
```

## أخطاء شائعة

### 1. نسيان التحويل قبل الحساب

```ruby
# خطأ!
age = gets.chomp
# TypeError!
next_year_age = age + 1

# صحيح
age = gets.chomp.to_i
# يعمل بشكل صحيح
next_year_age = age + 1
```

### 2. استخدام التحويل الخاطئ

```ruby
# خطأ - يفقد الكسر العشري
# 99 (فقد .99)
price = "99.99".to_i

# صحيح
# 99.99
price = "99.99".to_f
```

### 3. الخلط بين + للجمع والدمج

```ruby
a = "10"
b = "20"

# دمج نصوص (ليس جمع أرقام)
# "1020"
puts a + b

# جمع أرقام
# 30
puts a.to_i + b.to_i
```

## مثال شامل: حاسبة بسيطة

```ruby
puts "=== حاسبة بسيطة ==="
puts ""

puts "أدخل الرقم الأول:"
num1 = gets.chomp.to_f

puts "أدخل الرقم الثاني:"
num2 = gets.chomp.to_f

puts ""
puts "النتائج:"
puts "الجمع: #{num1} + #{num2} = #{num1 + num2}"
puts "الطرح: #{num1} - #{num2} = #{num1 - num2}"
puts "الضرب: #{num1} × #{num2} = #{num1 * num2}"

if num2 != 0
  puts "القسمة: #{num1} ÷ #{num2} = #{num1 / num2}"
else
  puts "القسمة: لا يمكن القسمة على صفر!"
end
```

## نصائح مهمة

1. **استخدم دائماً التحويل المناسب**: `to_i` للأعداد الصحيحة، `to_f` للأعداد العشرية
2. **تذكر أن gets تُرجع نصاً دائماً**: حتى لو أدخل المستخدم أرقاماً
3. **`to_i` لا تُنشئ خطأ**: النصوص غير الرقمية تصبح صفراً - تحقق من الإدخال إذا لزم الأمر
4. **استخدم `Integer()` أو `Float()` للتحويل الصارم**: عندما تريد التأكد من صحة الإدخال
5. **سلسلة التحويلات**: يمكنك ربط `chomp.strip.to_i` في سطر واحد

---

## التمرين

اكتب برنامجاً يطلب من المستخدم إدخال رقمين ثم يحسب ويطبع مجموعهما والفرق بينهما.

**ملاحظة:** استخدم حقل الإدخال المحاكى لإدخال الرقمين (كل رقم في سطر منفصل).

الناتج المتوقع:
```
أدخل الرقم الأول:
أدخل الرقم الثاني:
المجموع: 30
الفرق: 10
```
