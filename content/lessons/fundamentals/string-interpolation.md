# دمج المتغيرات في النصوص (String Interpolation)

تخيل أنك تريد طباعة رسالة ترحيب تحتوي على اسم المستخدم. كيف يمكنك دمج المتغير داخل النص؟ في هذا الدرس، سنتعلم تقنية قوية ومفيدة جداً في روبي!

## ما هو String Interpolation؟

**String Interpolation** (دمج المتغيرات) هو طريقة لإدراج قيم المتغيرات أو نتائج التعبيرات داخل نص. بدلاً من تجميع أجزاء النص يدوياً، يمكنك وضع المتغير مباشرة داخل النص!

```ruby
name = "أحمد"
puts "مرحباً #{name}!"
```

الناتج:
```
مرحباً أحمد!
```

## صياغة الدمج: #{}

القاعدة بسيطة:
1. استخدم علامات اقتباس **مزدوجة** `"..."`
2. ضع المتغير أو التعبير داخل `#{...}`

```ruby
age = 25
puts "عمري #{age} سنة"
```

الناتج:
```
عمري 25 سنة
```

> **مهم جداً:** الدمج يعمل فقط مع علامات الاقتباس المزدوجة `"..."`. لا يعمل مع علامات الاقتباس المفردة `'...'`!

## الفرق بين علامات الاقتباس

```ruby
name = "سارة"

# علامات مزدوجة - الدمج يعمل ✅
puts "مرحباً #{name}"

# علامات مفردة - الدمج لا يعمل ❌
puts 'مرحباً #{name}'
```

الناتج:
```
مرحباً سارة
مرحباً #{name}
```

كما ترى، علامات الاقتباس المفردة تطبع `#{name}` حرفياً بدلاً من قيمة المتغير!

## دمج تعبيرات حسابية

يمكنك وضع أي تعبير روبي داخل `#{}`، وليس فقط المتغيرات:

```ruby
a = 10
b = 5

puts "مجموع #{a} + #{b} = #{a + b}"
puts "ناتج الضرب: #{a * b}"
puts "#{a} أكبر من #{b}؟ #{a > b}"
```

الناتج:
```
مجموع 10 + 5 = 15
ناتج الضرب: 50
10 أكبر من 5؟ true
```

## دمج استدعاءات الدوال

يمكنك أيضاً استدعاء دوال داخل `#{}`:

```ruby
name = "محمد"

puts "الاسم بالحروف الكبيرة: #{name.upcase}"
puts "طول الاسم: #{name.length} أحرف"
puts "الاسم معكوساً: #{name.reverse}"
```

الناتج:
```
الاسم بالحروف الكبيرة: محمد
طول الاسم: 4 أحرف
الاسم معكوساً: دمحم
```

## مقارنة: الدمج مقابل الربط (+)

هناك طريقتان لبناء نص يحتوي على متغيرات:

### الطريقة الأولى: الربط باستخدام (+)

```ruby
name = "ليلى"
age = 20

# الربط يتطلب تحويل الأرقام إلى نص!
message = "اسمي " + name + " وعمري " + age.to_s + " سنة"
puts message
```

الناتج:
```
اسمي ليلى وعمري 20 سنة
```

### الطريقة الثانية: الدمج باستخدام #{}

```ruby
name = "ليلى"
age = 20

# الدمج يحوّل الأرقام تلقائياً!
message = "اسمي #{name} وعمري #{age} سنة"
puts message
```

الناتج:
```
اسمي ليلى وعمري 20 سنة
```

## لماذا الدمج أفضل؟

| الميزة | الربط (+) | الدمج (#{}) |
|--------|-----------|-------------|
| سهولة القراءة | ❌ صعب | ✅ سهل |
| تحويل الأنواع | ❌ يدوي (to_s) | ✅ تلقائي |
| الأخطاء | ❌ خطأ إذا نسيت to_s | ✅ لا أخطاء |
| الأداء | ❌ أبطأ قليلاً | ✅ أسرع |

> **نصيحة:** استخدم دائماً الدمج `#{}` بدلاً من الربط `+`. إنه أسهل وأقل عرضة للأخطاء!

## أمثلة عملية

### بناء رسالة ترحيب

```ruby
user_name = "خالد"
last_login = "أمس"

puts "مرحباً #{user_name}! آخر زيارة لك كانت #{last_login}."
```

الناتج:
```
مرحباً خالد! آخر زيارة لك كانت أمس.
```

### عرض معلومات منتج

```ruby
product = "هاتف ذكي"
price = 2500
currency = "ريال"

puts "المنتج: #{product}"
puts "السعر: #{price} #{currency}"
puts "السعر بعد الخصم 10%: #{price * 0.9} #{currency}"
```

الناتج:
```
المنتج: هاتف ذكي
السعر: 2500 ريال
السعر بعد الخصم 10%: 2250.0 ريال
```

### بناء مسار ملف

```ruby
folder = "documents"
filename = "report"
extension = "pdf"

path = "/home/user/#{folder}/#{filename}.#{extension}"
puts "مسار الملف: #{path}"
```

الناتج:
```
مسار الملف: /home/user/documents/report.pdf
```

## دمج عدة أسطر

يمكنك استخدام الدمج في نصوص متعددة الأسطر باستخدام heredoc أو ثلاث علامات اقتباس:

```ruby
name = "فاطمة"
course = "روبي بالعربي"
progress = 75

message = "
مرحباً #{name}!
أنت مسجل في دورة: #{course}
نسبة إكمالك: #{progress}%
"

puts message
```

الناتج:
```

مرحباً فاطمة!
أنت مسجل في دورة: روبي بالعربي
نسبة إكمالك: 75%

```

## الهروب من #{}

إذا أردت طباعة `#{}` حرفياً داخل علامات اقتباس مزدوجة، استخدم الشرطة المائلة العكسية `\`:

```ruby
name = "علي"
puts "استخدم \#{name} لدمج المتغيرات"
puts "قيمة name هي: #{name}"
```

الناتج:
```
استخدم #{name} لدمج المتغيرات
قيمة name هي: علي
```

## تعبيرات معقدة داخل #{}

يمكنك وضع أي تعبير روبي صالح داخل `#{}`:

```ruby
numbers = [1, 2, 3, 4, 5]

puts "المصفوفة: #{numbers}"
puts "المجموع: #{numbers.sum}"
puts "أول عنصر: #{numbers.first}"
puts "آخر عنصر: #{numbers.last}"
puts "العدد: #{numbers.length} عناصر"
```

الناتج:
```
المصفوفة: [1, 2, 3, 4, 5]
المجموع: 15
أول عنصر: 1
آخر عنصر: 5
العدد: 5 عناصر
```

## نصائح مهمة

1. **استخدم دائماً علامات الاقتباس المزدوجة** للنصوص التي تحتاج دمج
2. **لا تستخدم to_s** عند الدمج - روبي تفعل ذلك تلقائياً
3. **اجعل التعبيرات بسيطة** - إذا كان التعبير معقداً، احسبه في متغير أولاً
4. **تجنب الربط (+)** عندما يكون الدمج ممكناً

```ruby
# ❌ غير مستحسن
age = 25
puts "عمري " + age.to_s + " سنة"

# ✅ أفضل
puts "عمري #{age} سنة"
```

## تمرين: بناء نصوص ديناميكية

حان وقت التطبيق! في محرر الكود على اليسار:

**المطلوب:**
1. أنشئ متغير `city` يحتوي على "الرياض"
2. أنشئ متغير `temperature` يحتوي على 35
3. أنشئ متغير `day` يحتوي على "الأحد"
4. استخدم الدمج لطباعة:
   - "الطقس في الرياض"
   - "اليوم: الأحد"
   - "درجة الحرارة: 35 درجة مئوية"
   - "الحرارة بالفهرنهايت: [القيمة]" (استخدم الصيغة: temperature * 9/5 + 32)

الناتج المتوقع:
```
الطقس في الرياض
اليوم: الأحد
درجة الحرارة: 35 درجة مئوية
الحرارة بالفهرنهايت: 95
```

> **تلميح:** استخدم `#{}` لإدراج المتغيرات والحسابات داخل النصوص. تذكر أن تستخدم علامات الاقتباس المزدوجة!

---

> **تذكّر:** String Interpolation هو الطريقة المفضلة في روبي لبناء نصوص تحتوي على متغيرات. استخدم `"نص #{متغير} نص"` بدلاً من الربط بـ `+`.
