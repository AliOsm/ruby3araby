# حلقات while و until

في البرمجة، نحتاج أحياناً لتكرار شيفرة معين عدة مرات. بدلاً من كتابة نفس الشيفرة مراراً وتكراراً، نستخدم **الحلقات التكرارية** (Loops). في هذا الدرس، سنتعلم حلقتي `while` و `until`.

## حلقة while (طالما)

حلقة `while` تُكرر الشيفرة **طالما** الشرط صحيح (true). بمجرد أن يصبح الشرط خاطئاً (false)، تتوقف الحلقة.

### البنية الأساسية

```ruby
while الشرط
  # الشيفرة التي ستتكرر
end
```

### مثال بسيط: العد من 1 إلى 5

```ruby
counter = 1

while counter <= 5
  puts counter
  counter = counter + 1
end
```

الناتج:
```
1
2
3
4
5
```

### كيف تعمل الحلقة؟

1. **التحقق من الشرط:** هل `counter <= 5`؟ (هل 1 <= 5؟ نعم)
2. **تنفيذ الشيفرة:** اطبع counter، ثم زِد counter بـ 1
3. **العودة للخطوة 1:** تحقق من الشرط مجدداً
4. **التكرار:** يستمر حتى يصبح الشرط false (عندما counter = 6)

### مثال: العد التنازلي

```ruby
countdown = 5

while countdown > 0
  puts countdown
  # اختصار لـ countdown = countdown - 1
  countdown -= 1
end

puts "انطلق!"
```

الناتج:
```
5
4
3
2
1
انطلق!
```

## أهمية تحديث المتغير

**تحذير مهم:** إذا لم تُحدّث المتغير داخل الحلقة، ستحصل على **حلقة لا نهائية** (Infinite Loop)!

```ruby
# خطأ! حلقة لا نهائية
counter = 1
while counter <= 5
  puts counter
  # نسينا: counter += 1
end
# هذه الشيفرة لن تتوقف أبداً!
```

> **ملاحظة:** في المتصفح، ستتوقف الشيفرة تلقائياً بعد 60 ثانية لمنع تجميد الصفحة.

## أمثلة عملية

### مثال 1: جمع الأرقام من 1 إلى 10

```ruby
sum = 0
number = 1

while number <= 10
  sum += number
  number += 1
end

puts "مجموع الأرقام من 1 إلى 10 هو: #{sum}"
```

الناتج:
```
مجموع الأرقام من 1 إلى 10 هو: 55
```

### مثال 2: مضاعفة الرقم حتى يتجاوز 100

```ruby
value = 1

while value <= 100
  puts value
  # مضاعفة القيمة
  value *= 2
end
```

الناتج:
```
1
2
4
8
16
32
64
128
```

لاحظ أن 128 طُبعت لأن الشرط يُفحص **قبل** التنفيذ، و 64 <= 100.

### مثال 3: طباعة أعداد فردية

```ruby
num = 1

while num <= 10
  puts num
  num += 2
end
```

الناتج:
```
1
3
5
7
9
```

## حلقة until (حتى)

حلقة `until` هي **عكس** حلقة `while`. تُكرر الشيفرة **حتى** يصبح الشرط صحيحاً.

- `while` = كرر **طالما** الشرط صحيح
- `until` = كرر **حتى** يصبح الشرط صحيحاً (أي طالما الشرط خاطئ)

### البنية الأساسية

```ruby
until الشرط
  # الشيفرة التي ستتكرر
end
```

### مثال: العد من 1 إلى 5 باستخدام until

```ruby
counter = 1

until counter > 5
  puts counter
  counter += 1
end
```

الناتج:
```
1
2
3
4
5
```

### مقارنة while و until

نفس النتيجة، طريقتان مختلفتان:

```ruby
# باستخدام while
counter = 1
while counter <= 5
  puts counter
  counter += 1
end

# باستخدام until (نفس النتيجة)
counter = 1
until counter > 5
  puts counter
  counter += 1
end
```

| while | until | المعنى |
|-------|-------|--------|
| `while x <= 5` | `until x > 5` | طالما x أصغر أو يساوي 5 |
| `while x < 10` | `until x >= 10` | طالما x أصغر من 10 |
| `while x != 0` | `until x == 0` | طالما x لا يساوي صفر |

### مثال: العد التنازلي باستخدام until

```ruby
countdown = 5

until countdown == 0
  puts countdown
  countdown -= 1
end

puts "انطلق!"
```

الناتج:
```
5
4
3
2
1
انطلق!
```

## متى تستخدم while ومتى تستخدم until؟

### استخدم while عندما:
- تريد الاستمرار **طالما** شيء ما صحيح
- الشرط الطبيعي للاستمرار

```ruby
# استمر طالما هناك رصيد
balance = 1000
while balance > 0
  # إجراء عمليات...
  balance -= 100
end
```

### استخدم until عندما:
- تريد الاستمرار **حتى** يحدث شيء ما
- تنتظر تحقق شرط معين

```ruby
# استمر حتى يكتمل التحميل
progress = 0
until progress == 100
  progress += 10
  puts "التحميل: #{progress}%"
end
```

## الحلقات السطرية (Inline Loops)

يمكن كتابة حلقات بسيطة في سطر واحد باستخدام **المُعدِّل** (modifier):

```ruby
# while كمُعدِّل
counter = 1
puts(counter += 1) while counter < 5

# until كمُعدِّل
counter = 1
puts(counter += 1) until counter >= 5
```

الناتج (لكليهما):
```
2
3
4
5
```

> **ملاحظة:** الحلقات السطرية أقل وضوحاً، استخدمها فقط للعمليات البسيطة جداً.

## أمثلة عملية متقدمة

### مثال 1: إيجاد العوامل

```ruby
number = 24
divisor = 1

puts "عوامل العدد #{number}:"

while divisor <= number
  if number % divisor == 0
    puts divisor
  end
  divisor += 1
end
```

الناتج:
```
عوامل العدد 24:
1
2
3
4
6
8
12
24
```

### مثال 2: حساب المضروب (Factorial)

```ruby
n = 5
factorial = 1
counter = 1

while counter <= n
  factorial *= counter
  counter += 1
end

puts "#{n}! = #{factorial}"
```

الناتج:
```
5! = 120
```

### مثال 3: جدول الضرب

```ruby
number = 7
multiplier = 1

puts "جدول ضرب #{number}:"
puts "---------------"

while multiplier <= 10
  result = number * multiplier
  puts "#{number} × #{multiplier} = #{result}"
  multiplier += 1
end
```

الناتج:
```
جدول ضرب 7:
---------------
7 × 1 = 7
7 × 2 = 14
7 × 3 = 21
7 × 4 = 28
7 × 5 = 35
7 × 6 = 42
7 × 7 = 49
7 × 8 = 56
7 × 9 = 63
7 × 10 = 70
```

## حلقات متداخلة (Nested Loops)

يمكن وضع حلقة داخل حلقة أخرى:

```ruby
outer = 1

while outer <= 3
  inner = 1
  while inner <= 3
    puts "#{outer}, #{inner}"
    inner += 1
  end
  outer += 1
end
```

الناتج:
```
1, 1
1, 2
1, 3
2, 1
2, 2
2, 3
3, 1
3, 2
3, 3
```

### مثال: طباعة مثلث من النجوم

```ruby
row = 1

while row <= 5
  stars = "*" * row
  puts stars
  row += 1
end
```

الناتج:
```
*
**
***
****
*****
```

## الأخطاء الشائعة

### 1. نسيان تحديث المتغير

```ruby
# خطأ!
i = 0
while i < 5
  puts i
  # نسينا i += 1
end
```

### 2. شرط لا يتحقق أبداً

```ruby
# خطأ! الحلقة لن تنفذ
i = 10
while i < 5
  puts i
  i += 1
end
# لن يُطبع شيء لأن الشرط خاطئ من البداية
```

### 3. خطأ في اتجاه المقارنة

```ruby
# خطأ! حلقة لا نهائية
i = 1
while i > 0  # i دائماً أكبر من صفر!
  puts i
  i += 1
end
```

## جدول ملخص

| الحلقة | متى تستمر | متى تتوقف | الاستخدام |
|--------|-----------|-----------|-----------|
| `while شرط` | طالما الشرط true | عندما يصبح الشرط false | الاستمرار بشرط |
| `until شرط` | طالما الشرط false | عندما يصبح الشرط true | الانتظار لتحقق شرط |

## نصائح مهمة

1. **تأكد من تحديث المتغير** - لتجنب الحلقات اللانهائية
2. **تحقق من الشرط الابتدائي** - تأكد أن الحلقة ستنفذ مرة واحدة على الأقل إذا أردت
3. **استخدم += و -=** - لتبسيط شيفرة تحديث المتغيرات
4. **اختر while أو until** - بناءً على أيهما أوضح للقراءة
5. **احذر من الحلقات المتداخلة** - قد تؤثر على الأداء إذا كثرت التكرارات

## تمرين: العد التنازلي من 10

حان وقت التطبيق! في محرر الشيفرة على اليسار:

**المطلوب:**
اكتب برنامجاً يعد تنازلياً من 10 إلى 1، ثم يطبع "انطلق!".

1. عرّف متغير `countdown = 10`
2. استخدم حلقة `while` للعد التنازلي
3. اطبع كل رقم في سطر منفصل
4. بعد انتهاء الحلقة، اطبع "انطلق!"

الناتج المتوقع:
```
10
9
8
7
6
5
4
3
2
1
انطلق!
```

> **تلميح:** استخدم `countdown -= 1` أو `countdown = countdown - 1` لتقليل القيمة في كل تكرار.

---

> **تذكّر:** الحلقات أداة قوية، لكن تأكد دائماً أن لديك طريقة للخروج منها!
