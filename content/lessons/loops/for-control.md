# حلقة for والتحكم في التكرار

في الدرس السابق تعلمنا حلقات `while` و `until`. في هذا الدرس، سنتعلم حلقة `for` وكيفية التحكم في سير الحلقات باستخدام `break` و `next`.

## حلقة for

حلقة `for` تُكرر الشيفرة لكل عنصر في **نطاق** (Range) أو **مجموعة** (Collection). هي طريقة أنيقة للتكرار عندما تعرف مسبقاً عدد التكرارات.

### البنية الأساسية

```ruby
for متغير in نطاق
  # الشيفرة التي سيتكرر
end
```

### مثال بسيط: العد من 1 إلى 5

```ruby
for i in 1..5
  puts i
end
```

الناتج:
```
1
2
3
4
5
```

### فهم النطاقات (Ranges)

النطاق في روبي يُحدد مجموعة من القيم المتتالية:

| النطاق | المعنى | القيم |
|--------|--------|-------|
| `1..5` | من 1 إلى 5 (شامل) | 1, 2, 3, 4, 5 |
| `1...5` | من 1 إلى 5 (غير شامل) | 1, 2, 3, 4 |
| `'a'..'e'` | من a إلى e | a, b, c, d, e |

```ruby
# نطاق شامل (نقطتان)
puts "نطاق شامل 1..3:"
for i in 1..3
  puts i
end

puts "---"

# نطاق غير شامل (ثلاث نقاط)
puts "نطاق غير شامل 1...3:"
for i in 1...3
  puts i
end
```

الناتج:
```
نطاق شامل 1..3:
1
2
3
---
نطاق غير شامل 1...3:
1
2
```

### أمثلة عملية مع for

#### مثال 1: طباعة جدول ضرب

```ruby
number = 5

puts "جدول ضرب #{number}:"
for i in 1..10
  result = number * i
  puts "#{number} × #{i} = #{result}"
end
```

الناتج:
```
جدول ضرب 5:
5 × 1 = 5
5 × 2 = 10
5 × 3 = 15
5 × 4 = 20
5 × 5 = 25
5 × 6 = 30
5 × 7 = 35
5 × 8 = 40
5 × 9 = 45
5 × 10 = 50
```

#### مثال 2: جمع الأرقام

```ruby
sum = 0

for i in 1..10
  sum += i
end

puts "مجموع الأرقام من 1 إلى 10: #{sum}"
```

الناتج:
```
مجموع الأرقام من 1 إلى 10: 55
```

#### مثال 3: طباعة الحروف

```ruby
puts "الحروف من a إلى f:"
for letter in 'a'..'f'
  puts letter
end
```

الناتج:
```
الحروف من a إلى f:
a
b
c
d
e
f
```

## التحكم في الحلقات

أحياناً نريد تغيير السير الطبيعي للحلقة. روبي توفر كلمتين مفتاحيتين للتحكم:

- `break` - الخروج من الحلقة فوراً
- `next` - تخطي التكرار الحالي والانتقال للتالي

## break - الخروج من الحلقة

`break` يُنهي الحلقة فوراً ويخرج منها، حتى لو لم تنتهِ الشروط.

### مثال: البحث عن رقم معين

```ruby
puts "البحث عن الرقم 5:"

for i in 1..10
  puts "فحص الرقم #{i}..."
  if i == 5
    puts "وجدنا الرقم 5! نخرج من الحلقة."
    break
  end
end

puts "انتهى البحث."
```

الناتج:
```
البحث عن الرقم 5:
فحص الرقم 1...
فحص الرقم 2...
فحص الرقم 3...
فحص الرقم 4...
فحص الرقم 5...
وجدنا الرقم 5! نخرج من الحلقة.
انتهى البحث.
```

لاحظ أن الحلقة توقفت عند 5 ولم تكمل حتى 10.

### مثال: إيقاف عند حد معين

```ruby
sum = 0

for i in 1..100
  sum += i
  if sum > 50
    puts "المجموع تجاوز 50 عند i = #{i}"
    puts "المجموع الحالي: #{sum}"
    break
  end
end
```

الناتج:
```
المجموع تجاوز 50 عند i = 10
المجموع الحالي: 55
```

### استخدام break مع while

```ruby
counter = 0

while true  # حلقة لا نهائية!
  counter += 1
  puts counter

  if counter >= 5
    break  # نخرج عند 5
  end
end

puts "خرجنا من الحلقة"
```

الناتج:
```
1
2
3
4
5
خرجنا من الحلقة
```

## next - تخطي التكرار الحالي

`next` يتخطى بقية الشيفرة في التكرار الحالي وينتقل مباشرة للتكرار التالي.

### مثال: طباعة الأرقام الزوجية فقط

```ruby
puts "الأرقام الزوجية من 1 إلى 10:"

for i in 1..10
  if i % 2 != 0  # إذا كان الرقم فردياً
    next  # تخطّه وانتقل للتالي
  end
  puts i
end
```

الناتج:
```
الأرقام الزوجية من 1 إلى 10:
2
4
6
8
10
```

### مثال: تخطي قيم معينة

```ruby
puts "طباعة الأرقام من 1 إلى 10 (بدون 3 و 7):"

for i in 1..10
  if i == 3 || i == 7
    next
  end
  puts i
end
```

الناتج:
```
طباعة الأرقام من 1 إلى 10 (بدون 3 و 7):
1
2
4
5
6
8
9
10
```

### مثال: معالجة البيانات مع تخطي الفارغة

```ruby
names = ["أحمد", "", "سارة", nil, "محمد", ""]

puts "الأسماء الصالحة:"

for name in names
  if name.nil? || name.empty?
    next  # تخطي الأسماء الفارغة أو nil
  end
  puts "مرحباً #{name}!"
end
```

الناتج:
```
الأسماء الصالحة:
مرحباً أحمد!
مرحباً سارة!
مرحباً محمد!
```

## الجمع بين break و next

يمكن استخدام كليهما في نفس الحلقة:

```ruby
puts "البحث عن أول رقم زوجي أكبر من 10:"

for i in 1..20
  # تخطي الأرقام الفردية
  if i % 2 != 0
    next
  end

  # تخطي الأرقام أصغر أو تساوي 10
  if i <= 10
    next
  end

  # وجدنا الرقم المطلوب
  puts "الرقم هو: #{i}"
  break
end
```

الناتج:
```
البحث عن أول رقم زوجي أكبر من 10:
الرقم هو: 12
```

## أمثلة عملية متقدمة

### مثال 1: إيجاد الأعداد الأولية

```ruby
puts "الأعداد الأولية من 2 إلى 20:"

for num in 2..20
  is_prime = true

  for divisor in 2...num
    if num % divisor == 0
      is_prime = false
      break  # لا حاجة للاستمرار
    end
  end

  if is_prime
    puts num
  end
end
```

الناتج:
```
الأعداد الأولية من 2 إلى 20:
2
3
5
7
11
13
17
19
```

### مثال 2: طباعة مثلث من الأرقام

```ruby
for row in 1..5
  line = ""
  for col in 1..row
    line += "#{col} "
  end
  puts line
end
```

الناتج:
```
1
1 2
1 2 3
1 2 3 4
1 2 3 4 5
```

### مثال 3: البحث عن مضاعفات مشتركة

```ruby
puts "أول 5 أرقام قابلة للقسمة على 3 و 5:"
count = 0

for i in 1..100
  if i % 3 != 0 || i % 5 != 0
    next
  end

  puts i
  count += 1

  if count == 5
    break
  end
end
```

الناتج:
```
أول 5 أرقام قابلة للقسمة على 3 و 5:
15
30
45
60
75
```

## مقارنة for مع while

| الميزة | for | while |
|--------|-----|-------|
| **متى تستخدم** | عدد تكرارات معروف | شرط غير محدد العدد |
| **النطاقات** | مثالية | تحتاج متغير عداد |
| **القراءة** | أوضح للتكرار المحدد | أوضح للشروط المعقدة |
| **المتغير** | يُعرَّف تلقائياً | تحتاج تعريفه يدوياً |

```ruby
# نفس النتيجة بطريقتين:

# باستخدام for
for i in 1..5
  puts i
end

# باستخدام while
i = 1
while i <= 5
  puts i
  i += 1
end
```

## جدول ملخص التحكم في الحلقات

| الأمر | الوظيفة | متى تستخدمه |
|-------|---------|-------------|
| `break` | الخروج من الحلقة فوراً | عند إيجاد القيمة المطلوبة أو تحقق شرط الإنهاء |
| `next` | تخطي التكرار الحالي | لتجاهل قيم معينة والاستمرار |

## نصائح مهمة

1. **استخدم for للنطاقات المعروفة** - أوضح وأقصر من while
2. **استخدم break للخروج المبكر** - لتوفير الوقت عند إيجاد المطلوب
3. **استخدم next لتصفية القيم** - أوضح من وضع الشيفرة في else
4. **احذر من break في حلقات متداخلة** - يخرج فقط من الحلقة الداخلية
5. **فضّل each على for** - في روبي الحديثة (سنتعلمها لاحقاً)

## الأخطاء الشائعة

### 1. نسيان أن break يخرج من الحلقة الداخلية فقط

```ruby
for i in 1..3
  for j in 1..3
    if j == 2
      break  # يخرج فقط من حلقة j
    end
    puts "#{i}, #{j}"
  end
end
```

الناتج:
```
1, 1
2, 1
3, 1
```

### 2. وضع next في المكان الخطأ

```ruby
# خطأ: الشيفرة بعد next لن يُنفذ أبداً
for i in 1..5
  next
  puts i  # لن يُطبع شيء!
end
```

### 3. استخدام break بدلاً من next

```ruby
# خطأ: سيخرج من الحلقة كاملة
for i in 1..10
  if i == 3
    break  # نريد تخطي 3 فقط، لا الخروج!
  end
  puts i
end
# الناتج: 1, 2 فقط!

# صحيح: استخدم next لتخطي
for i in 1..10
  if i == 3
    next
  end
  puts i
end
# الناتج: 1, 2, 4, 5, 6, 7, 8, 9, 10
```

## تمرين: الأرقام الزوجية مع استثناءات

حان وقت التطبيق! في محرر الشيفرة على اليسار:

**المطلوب:**
اكتب برنامجاً يطبع الأرقام الزوجية من 1 إلى 20، لكن:
1. تخطَّ الرقم 6 (لا تطبعه)
2. توقف عند الوصول للرقم 14 (اطبعه ثم توقف)

**تلميحات:**
- استخدم `for i in 1..20`
- استخدم `next` لتخطي الرقم 6
- استخدم `i % 2 == 0` للتحقق من الزوجية
- استخدم `break` للتوقف بعد طباعة 14

الناتج المتوقع:
```
2
4
8
10
12
14
```

> **ملاحظة:** لاحظ أن 6 غير موجود في الناتج (تم تخطيه)، والحلقة توقفت عند 14.

---

> **تذكّر:** `break` للخروج، `next` للتخطي. استخدمهما بحكمة لكتابة شيفرة أكثر كفاءة!
