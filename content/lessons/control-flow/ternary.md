# العامل الثلاثي (Ternary Operator)

تعلمنا في الدروس السابقة كيفية استخدام `if-else` و `case/when` لاتخاذ القرارات. لكن أحياناً نحتاج لشرط بسيط جداً ونريد كتابته بشكل مختصر. هنا يأتي دور **العامل الثلاثي** (Ternary Operator)!

## ما هو العامل الثلاثي؟

العامل الثلاثي هو طريقة مختصرة لكتابة جملة `if-else` بسيطة في سطر واحد. سُمي "ثلاثياً" لأنه يتكون من **ثلاثة أجزاء**:

```
الشرط ? النتيجة_إذا_صحيح : النتيجة_إذا_خاطئ
```

### مثال أساسي

```ruby
age = 20

# باستخدام if-else التقليدية
if age >= 18
  status = "بالغ"
else
  status = "قاصر"
end
puts status

# باستخدام العامل الثلاثي
status = age >= 18 ? "بالغ" : "قاصر"
puts status
```

الناتج:
```
بالغ
بالغ
```

كلا الطريقتين تعطي نفس النتيجة، لكن العامل الثلاثي أقصر بكثير!

## البنية الأساسية

```ruby
المتغير = الشرط ? قيمة_إذا_صحيح : قيمة_إذا_خاطئ
```

أو يمكن استخدامه مباشرة:

```ruby
puts الشرط ? "صحيح" : "خاطئ"
```

### شرح الأجزاء الثلاثة

| الجزء | الوصف | مثال |
|-------|-------|-------|
| الشرط | التعبير الذي يُقيّم إلى true أو false | `age >= 18` |
| `?` | الفاصل بين الشرط والنتيجة الصحيحة | `?` |
| النتيجة إذا صحيح | القيمة التي تُرجع إذا كان الشرط true | `"بالغ"` |
| `:` | الفاصل بين النتيجتين | `:` |
| النتيجة إذا خاطئ | القيمة التي تُرجع إذا كان الشرط false | `"قاصر"` |

## أمثلة عملية

### مثال 1: التحقق من الإيجابية

```ruby
number = -5

sign = number >= 0 ? "موجب أو صفر" : "سالب"
puts sign
```

الناتج:
```
سالب
```

### مثال 2: زوجي أم فردي

```ruby
number = 7

result = number.even? ? "زوجي" : "فردي"
puts "الرقم #{number} هو #{result}"
```

الناتج:
```
الرقم 7 هو فردي
```

### مثال 3: القيمة المطلقة

```ruby
x = -15

absolute = x >= 0 ? x : -x
puts "القيمة المطلقة لـ #{x} هي #{absolute}"
```

الناتج:
```
القيمة المطلقة لـ -15 هي 15
```

### مثال 4: رسالة ترحيب

```ruby
logged_in = true
username = "أحمد"

greeting = logged_in ? "مرحباً #{username}!" : "مرحباً زائر!"
puts greeting
```

الناتج:
```
مرحباً أحمد!
```

### مثال 5: تحديد السعر

```ruby
is_member = true
base_price = 100

final_price = is_member ? base_price * 0.8 : base_price
puts "السعر النهائي: #{final_price.to_i} ريال"
```

الناتج:
```
السعر النهائي: 80 ريال
```

## استخدام العامل الثلاثي مع puts مباشرة

يمكن استخدام العامل الثلاثي داخل `puts` مباشرة:

```ruby
score = 75

puts score >= 60 ? "ناجح" : "راسب"
```

الناتج:
```
ناجح
```

### مثال: عرض الحالة

```ruby
is_available = false

puts "المنتج #{is_available ? "متوفر" : "غير متوفر"}"
```

الناتج:
```
المنتج غير متوفر
```

## العامل الثلاثي في String Interpolation

يمكن استخدامه داخل `#{}` في النصوص:

```ruby
items_count = 1

puts "لديك #{items_count} #{items_count == 1 ? "عنصر" : "عناصر"}"
```

الناتج:
```
لديك 1 عنصر
```

### مثال: صيغة الجمع والمفرد

```ruby
messages_count = 5

puts "لديك #{messages_count} #{messages_count == 1 ? "رسالة جديدة" : "رسائل جديدة"}"
```

الناتج:
```
لديك 5 رسائل جديدة
```

## متى تستخدم العامل الثلاثي؟

### استخدمه عندما:

1. **الشرط بسيط** - شرط واحد بدون تعقيد
2. **النتيجتان قصيرتان** - قيم بسيطة أو نصوص قصيرة
3. **تريد تعيين قيمة لمتغير** - بناءً على شرط بسيط

```ruby
# مثالي للعامل الثلاثي
status = active ? "نشط" : "غير نشط"

# مثالي للعامل الثلاثي
discount = is_member ? 20 : 0

# مثالي للعامل الثلاثي
greeting = time < 12 ? "صباح الخير" : "مساء الخير"
```

### لا تستخدمه عندما:

1. **الشرط معقد** - يحتوي على `&&` أو `||` متعددة
2. **النتيجة تتطلب عدة أسطر** - كود طويل أو معقد
3. **هناك أكثر من احتمالين** - تحتاج `elsif`

```ruby
# لا تستخدم العامل الثلاثي هنا - معقد جداً
# السيء:
result = a > 0 && b > 0 ? a + b : a < 0 && b < 0 ? -(a.abs + b.abs) : 0

# الأفضل: استخدم if-elsif-else
if a > 0 && b > 0
  result = a + b
elsif a < 0 && b < 0
  result = -(a.abs + b.abs)
else
  result = 0
end
```

## المقارنة: العامل الثلاثي vs if-else

| الميزة | العامل الثلاثي | if-else |
|--------|---------------|---------|
| الإيجاز | ممتاز (سطر واحد) | يحتاج عدة أسطر |
| القراءة | جيد للشروط البسيطة | أوضح للشروط المعقدة |
| الكود الطويل | غير مناسب | مناسب |
| تعدد الشروط | لا يدعم | يدعم (elsif) |
| تعيين متغير | مثالي | جيد |

## تحويل if-else إلى عامل ثلاثي

### مثال 1: تحويل بسيط

قبل (if-else):
```ruby
temperature = 35

if temperature > 30
  weather = "حار"
else
  weather = "معتدل"
end
puts weather
```

بعد (عامل ثلاثي):
```ruby
temperature = 35

weather = temperature > 30 ? "حار" : "معتدل"
puts weather
```

الناتج:
```
حار
```

### مثال 2: تحويل مع puts

قبل:
```ruby
balance = 100

if balance > 0
  puts "رصيد موجب"
else
  puts "رصيد سالب أو صفر"
end
```

بعد:
```ruby
balance = 100

puts balance > 0 ? "رصيد موجب" : "رصيد سالب أو صفر"
```

الناتج:
```
رصيد موجب
```

### مثال 3: تحويل مع حساب

قبل:
```ruby
price = 200
has_coupon = true

if has_coupon
  final_price = price - 50
else
  final_price = price
end
puts "السعر: #{final_price}"
```

بعد:
```ruby
price = 200
has_coupon = true

final_price = has_coupon ? price - 50 : price
puts "السعر: #{final_price}"
```

الناتج:
```
السعر: 150
```

## تداخل العامل الثلاثي (تجنبه!)

تقنياً، يمكن تداخل العوامل الثلاثية، لكن هذا يجعل الكود صعب القراءة:

```ruby
score = 85

# سيء - صعب الفهم
grade = score >= 90 ? "ممتاز" : score >= 80 ? "جيد جداً" : score >= 70 ? "جيد" : "مقبول"
puts grade
```

الناتج:
```
جيد جداً
```

**الأفضل: استخدم if-elsif-else أو case/when:**

```ruby
score = 85

# أوضح بكثير!
grade = if score >= 90
  "ممتاز"
elsif score >= 80
  "جيد جداً"
elsif score >= 70
  "جيد"
else
  "مقبول"
end
puts grade
```

## نصائح مهمة

1. **اجعله بسيطاً** - العامل الثلاثي للشروط البسيطة فقط
2. **لا تتداخل** - تجنب وضع عامل ثلاثي داخل آخر
3. **استخدم الأقواس عند الحاجة** - للوضوح في التعبيرات المعقدة
4. **فكر في القراءة** - إذا صعب فهمه، استخدم if-else
5. **مثالي للتعيين** - أفضل استخدام له هو تعيين قيمة لمتغير

## أمثلة إضافية

### التحقق من القسمة على صفر

```ruby
a = 10
b = 0

result = b != 0 ? a / b : "لا يمكن القسمة على صفر"
puts result
```

الناتج:
```
لا يمكن القسمة على صفر
```

### قيمة افتراضية

```ruby
name = nil

display_name = name ? name : "زائر"
puts "مرحباً #{display_name}"
```

الناتج:
```
مرحباً زائر
```

> **ملاحظة:** يمكن استخدام `||` أيضاً للقيم الافتراضية: `display_name = name || "زائر"`

### رسالة نجاح أو فشل

```ruby
success = true

puts success ? "تمت العملية بنجاح ✓" : "فشلت العملية ✗"
```

الناتج:
```
تمت العملية بنجاح ✓
```

## جدول ملخص

| الصيغة | الوصف | مثال |
|--------|-------|-------|
| `شرط ? أ : ب` | إرجاع أ إذا صحيح، ب إذا خاطئ | `x > 0 ? "موجب" : "سالب"` |
| `متغير = شرط ? أ : ب` | تعيين قيمة بناءً على شرط | `status = active ? "نشط" : "متوقف"` |
| `puts شرط ? أ : ب` | طباعة قيمة بناءً على شرط | `puts ok ? "نعم" : "لا"` |
| `"#{شرط ? أ : ب}"` | استخدام داخل نص | `"#{x > 0 ? "+" : "-"}"` |

## تمرين: تحويل if-else إلى عامل ثلاثي

حان وقت التطبيق! في محرر الكود على اليسار:

**المطلوب:**
حوّل الكود التالي من if-else إلى عامل ثلاثي:

الكود الأصلي:
```ruby
number = 10
if number > 0
  puts "موجب"
else
  puts "سالب أو صفر"
end
```

1. عرّف متغير `number = 10`
2. استخدم العامل الثلاثي مع puts لطباعة "موجب" إذا كان الرقم أكبر من صفر، و"سالب أو صفر" إذا لم يكن

الناتج المتوقع:
```
موجب
```

> **تلميح:** الصيغة هي: `puts الشرط ? "النتيجة الأولى" : "النتيجة الثانية"`

---

> **تذكّر:** العامل الثلاثي أداة قوية لتبسيط الشروط البسيطة، لكن استخدم if-else للشروط المعقدة!
